<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Gestión de Cargas - LogiAduana</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --sidebar-width: 250px;
      --sidebar-collapsed: 70px;
      --transition-speed: 0.3s;
    }
    
    body {
      background: #f8f9fa;
      min-height: 100vh;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    
    #sidebar {
      width: var(--sidebar-width);
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      background: #343a40;
      color: white;
      transition: all var(--transition-speed) ease;
      z-index: 1000;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    }
    
    #sidebar.collapsed {
      width: var(--sidebar-collapsed);
    }
    
    .sidebar-header {
      padding: 1.5rem 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      text-align: center;
      transition: all var(--transition-speed) ease;
    }
    
    #sidebar.collapsed .sidebar-header {
      padding: 1rem 0.5rem;
    }
    
    .logo {
      font-weight: 700;
      font-size: 1.5rem;
      white-space: nowrap;
      overflow: hidden;
    }
    
    #sidebar.collapsed .logo span {
      display: none;
    }
    
    .toggle-btn {
      position: absolute;
      right: -15px;
      top: 1.5rem;
      background: #343a40;
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: all var(--transition-speed) ease;
    }
    
    .toggle-btn:hover {
      background: #495057;
      transform: scale(1.1);
    }
    
    #sidebar.collapsed .toggle-btn {
      transform: rotate(180deg);
    }
    
    .sidebar-menu {
      list-style: none;
      padding: 0;
      margin: 1rem 0;
    }
    
    .sidebar-menu li {
      margin: 0.5rem 0;
    }
    
    .sidebar-menu a {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      color: rgba(255,255,255,0.8);
      text-decoration: none;
      transition: all 0.2s ease;
      white-space: nowrap;
      overflow: hidden;
    }
    
    .sidebar-menu a:hover {
      background: rgba(255,255,255,0.1);
      color: white;
    }
    
    .sidebar-menu a.active {
      background: rgba(255,255,255,0.15);
      color: white;
      border-left: 4px solid #0d6efd;
    }
    
    .sidebar-menu i {
      width: 24px;
      text-align: center;
      margin-right: 1rem;
      font-size: 1.1rem;
    }
    
    #sidebar.collapsed .sidebar-menu span {
      display: none;
    }
    
    .menu-text {
      transition: opacity var(--transition-speed) ease;
    }
    
    #sidebar.collapsed .menu-text {
      opacity: 0;
    }
    
    .main-content {
      margin-left: var(--sidebar-width);
      transition: all var(--transition-speed) ease;
      min-height: 100vh;
      padding: 20px;
    }
    
    #sidebar.collapsed ~ .main-content {
      margin-left: var(--sidebar-collapsed);
    }
    
    /* Estilos específicos para la sección de cargas */
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #dee2e6;
    }
    
    .page-title {
      color: #2c3e50;
      font-weight: 600;
    }
    
    .btn-new {
      font-weight: 600;
      padding: 0.7rem 1.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    
    .btn-new:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
    }
    
    .filter-card {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      border: none;
      margin-bottom: 1.5rem;
    }
    
    .filter-card .card-header {
      background-color: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      font-weight: 600;
      color: #495057;
    }
    
    .table-container {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .table thead th {
      background-color: #f8f9fa;
      border-bottom: 2px solid #dee2e6;
      font-weight: 600;
      color: #495057;
      padding: 1rem;
    }
    
    .table tbody td {
      padding: 0.9rem;
      vertical-align: middle;
    }
    
    .status-badge {
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .status-pendiente {
      background-color: #fff3cd;
      color: #856404;
    }
    
    .status-en-transito {
      background-color: #d1ecf1;
      color: #0c5460;
    }
    
    .status-entregado {
      background-color: #d4edda;
      color: #155724;
    }
    
    .action-buttons .btn {
      margin-right: 0.3rem;
    }
    
    @media (max-width: 768px) {
      #sidebar {
        width: var(--sidebar-collapsed);
      }
      
      #sidebar:not(.collapsed) {
        width: var(--sidebar-width);
      }
      
      .main-content {
        margin-left: var(--sidebar-collapsed);
        padding: 15px;
      }
      
      #sidebar:not(.collapsed) ~ .main-content {
        margin-left: var(--sidebar-width);
      }
      
      .page-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .btn-new {
        margin-top: 1rem;
        width: 100%;
      }
    }
  </style>
</head>
<body>

<!-- Barra lateral -->
<div id="sidebar">
  <div class="sidebar-header">
    <div class="logo">
      <i class="fas fa-ship"></i>
      <span class="ms-2">LogiAduana</span>
    </div>
    <button class="toggle-btn" id="sidebarToggle">
      <i class="fas fa-chevron-left"></i>
    </button>
  </div>
  
  <ul class="sidebar-menu">
    <li>
      <a th:href="@{/}">
        <i class="fas fa-home"></i>
        <span class="menu-text">Dashboard</span>
      </a>
    </li>
    <li>
      <a th:href="@{/cargas}" class="active">
        <i class="fas fa-truck"></i>
        <span class="menu-text">Cargas</span>
      </a>
    </li>
    <li>
      <a th:href="@{/tracking}">
        <i class="fas fa-map-marker-alt"></i>
        <span class="menu-text">Tracking</span>
      </a>
    </li>
    <li>
      <a th:href="@{/reportes}">
        <i class="fas fa-chart-bar"></i>
        <span class="menu-text">Reportes</span>
      </a>
    </li>
    <li>
      <a th:href="@{/usuarios}">
        <i class="fas fa-users"></i>
        <span class="menu-text">Usuarios</span>
      </a>
    </li>
  </ul>
</div>

<!-- Contenido principal -->
<div class="main-content">
  <div class="container mt-4">
    <!-- Encabezado de página -->
    <div class="page-header">
      <h1 class="page-title">
        <i class="fas fa-truck-loading me-2"></i>Gestión de Cargas
      </h1>
      <a class="btn btn-success btn-new" th:href="@{/cargas/nueva}">
        <i class="fas fa-plus-circle me-2"></i>Nueva Carga
      </a>
    </div>

    <!-- Filtros de Cargas -->
    <div class="card filter-card">
      <div class="card-header py-3">
        <i class="fas fa-filter me-2"></i>Filtros de Búsqueda
      </div>
      <div class="card-body">
        <div class="row g-3 align-items-end">
          <div class="col-md-5">
            <label class="form-label fw-semibold">Buscar por número de guía</label>
            <input id="filtroGuiaCarga" type="text" class="form-control" placeholder="Ej: 001-ABC-2025">
          </div>
          <div class="col-md-4">
            <label class="form-label fw-semibold">Filtrar por estado</label>
            <select id="filtroEstadoCargaSelect" class="form-select">
              <option value="">Todos los estados</option>
            </select>
          </div>
          <div class="col-md-3">
            <button id="btnLimpiarCargas" class="btn btn-outline-secondary w-100">
              <i class="fas fa-eraser me-1"></i>Limpiar Filtros
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabla de Cargas -->
    <div class="table-container">
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            <th>ID</th>
            <th>Número Guía</th>
            <th>Cliente</th>
            <th>Descripción</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="carga : ${cargas}">
            <td th:text="${carga.id}"></td>
            <td>
              <span class="fw-semibold" th:text="${carga.numeroGuia}"></span>
            </td>
            <td th:text="${carga.cliente}"></td>
            <td th:text="${carga.descripcion}"></td>
            <td>
              <span th:classappend="'status-badge ' + ${carga.estado == 'Pendiente' ? 'status-pendiente' : (carga.estado == 'En tránsito' ? 'status-en-transito' : 'status-entregado')}" 
                    th:text="${carga.estado}"></span>
            </td>
            <td class="action-buttons">
              <a th:href="@{/cargas/editar/{id}(id=${carga.id})}" class="btn btn-warning btn-sm">
                <i class="fas fa-edit"></i> Editar
              </a>
              <a th:href="@{/cargas/eliminar/{id}(id=${carga.id})}" class="btn btn-danger btn-sm" 
                 onclick="return confirm('¿Seguro que deseas eliminar esta carga?');">
                <i class="fas fa-trash-alt"></i> Eliminar
              </a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('sidebarToggle');
    
    // Verificar si hay un estado guardado en localStorage
    const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    if (isCollapsed) {
      sidebar.classList.add('collapsed');
    }
    
    toggleBtn.addEventListener('click', function() {
      sidebar.classList.toggle('collapsed');
      
      // Guardar el estado en localStorage
      localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
    });
    
    // Cerrar sidebar en móviles al hacer clic en un enlace
    if (window.innerWidth <= 768) {
      const menuLinks = document.querySelectorAll('.sidebar-menu a');
      menuLinks.forEach(link => {
        link.addEventListener('click', function() {
          if (!sidebar.classList.contains('collapsed')) {
            sidebar.classList.add('collapsed');
            localStorage.setItem('sidebarCollapsed', 'true');
          }
        });
      });
    }
  });

  // Script para filtros (mantenido de tu código original)
  (function(){
    function getHeaderIndex(table, headerTexts){
      var ths = table.querySelectorAll('thead th');
      function norm(t){ return (t||'').toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,''); }
      for (var i=0;i<ths.length;i++){
        var txt = norm(ths[i].innerText||'');
        for (var j=0;j<headerTexts.length;j++){
          if (txt.includes(norm(headerTexts[j]))) return i;
        }
      }
      return -1;
    }
    function buildEstadoOptions(table){
      var estadoCol = getHeaderIndex(table, ['estado']);
      var select = document.getElementById('filtroEstadoCargaSelect');
      if(estadoCol < 0 || !select) return;
      var set = new Set();
      table.querySelectorAll('tbody tr').forEach(function(tr){
        var tds = tr.querySelectorAll('td');
        var val = tds[estadoCol] ? (tds[estadoCol].innerText||'').trim() : '';
        if(val) set.add(val);
      });
      Array.from(set).sort().forEach(function(val){
        var opt = document.createElement('option');
        opt.value = val;
        opt.textContent = val;
        select.appendChild(opt);
      });
    }
    function filtrar(){
      var table = document.querySelector('table');
      if(!table) return;
      var guiaCol = getHeaderIndex(table, ['guia','guía','numero de guia','número de guia','nro guia','num guia','n° guia']);
      var estadoCol = getHeaderIndex(table, ['estado']);
      var filtroGuia = (document.getElementById('filtroGuiaCarga').value||'').trim().toLowerCase();
      var filtroEstado = (document.getElementById('filtroEstadoCargaSelect').value||'').trim().toLowerCase();
      var rows = table.querySelectorAll('tbody tr');
      rows.forEach(function(tr){
        var tds = tr.querySelectorAll('td');
        var guia = guiaCol >=0 && tds[guiaCol] ? (tds[guiaCol].innerText||'').toLowerCase() : '';
        var estado = estadoCol >=0 && tds[estadoCol] ? (tds[estadoCol].innerText||'').toLowerCase() : '';
        var okGuia = !filtroGuia || guia.includes(filtroGuia);
        var okEstado = !filtroEstado || estado === filtroEstado;
        tr.style.display = (okGuia && okEstado) ? '' : 'none';
      });
    }
    document.addEventListener('input', function(e){
      if(e.target && e.target.id === 'filtroGuiaCarga'){ filtrar(); }
    });
    document.addEventListener('change', function(e){
      if(e.target && e.target.id === 'filtroEstadoCargaSelect'){ filtrar(); }
    });
    document.addEventListener('click', function(e){
      if(e.target && e.target.id === 'btnLimpiarCargas'){
        e.preventDefault();
        var g = document.getElementById('filtroGuiaCarga');
        var s = document.getElementById('filtroEstadoCargaSelect');
        if(g) g.value='';
        if(s) s.value='';
        filtrar();
      }
    });
    window.addEventListener('DOMContentLoaded', function(){
      var table = document.querySelector('table');
      if(table) buildEstadoOptions(table);
      filtrar();
    });
  })();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>